/**
 * Detail Preview Extension for PHPMaker 2018
 * @license (C) 2017 e.World Technology Ltd.
 */
var EW_LOADING_HTML="<div class='loader'><div class='circle'></div><div class='circle'></div><div class='circle'></div><div class='circle'></div><div class='circle'></div><div></div></div> "+ewLanguage.Phrase("Loading");var EW_PREVIEW_BUTTON_SELECTOR=".ewPreviewRowBtn";function ew_AddRowToTable(t){var e=jQuery,a=e(t),r,o,i=0;var d=a.closest("tbody");if(EW_PREVIEW_SINGLE_ROW)d.find("tr."+EW_TABLE_PREVIEW_ROW_CLASSNAME).remove();e(t.cells).each(function(){i+=this.colSpan});var s=a.nextAll("tr[data-rowindex!="+a.data("rowindex")+"]").first();if(s.hasClass(EW_TABLE_PREVIEW_ROW_CLASSNAME)){return s[0]}else if(r=d[0].insertRow(s[0]?s[0].sectionRowIndex:-1)){e(r).addClass(EW_TABLE_PREVIEW_ROW_CLASSNAME);o=e(r.insertCell(0)).addClass(EW_TABLE_LAST_COL_CLASSNAME).prop("colSpan",i)}return r}function ew_ShowDetails(t){var e=jQuery,a=e(this),r=a.is("tr[data-rowindex]"),o=r?a:a.closest("tr[data-rowindex]"),i=o.closest("table");if(!o[0])return;if(!o.data("preview")){var d=ew_AddRowToTable(o[0]);var s=e(d.cells[0]);var n=o.find("[class$=_preview] div.ewPreview");s.empty();s.append(e("#ewPreview").contents().clone()).find(".nav-tabs").append(n.find("li:has([data-toggle='tab'])").clone(true)).find("[data-toggle='tab']").attr("data-target","#"+s.find(".tab-pane").attr("id",ew_Random()).attr("id")).first().tab("show");(EW_PREVIEW_SINGLE_ROW?i:o).find(EW_PREVIEW_BUTTON_SELECTOR).removeClass("fa fa-compress text-danger").addClass("fa fa-expand text-success");o.data("preview",true).find(EW_PREVIEW_BUTTON_SELECTOR).removeClass("fa fa-expand text-success").addClass("fa fa-compress text-danger")}else{var l=o.nextAll("tr[data-rowindex!='"+o.data("rowindex")+"']").first();if(l.hasClass(EW_TABLE_PREVIEW_ROW_CLASSNAME))l.remove();o.data("preview",false).find(EW_PREVIEW_BUTTON_SELECTOR).removeClass("fa fa-compress text-danger").addClass("fa fa-expand text-success")}ew_SetupTable(-1,i[0],true)}function ew_Detail(t,e){var a=jQuery,r=a(e),o=r.closest(".ewListOptionBody"),i=r.data("placement")||EW_PREVIEW_PLACEMENT,d=o.find(".dropdown-menu"),s=o.find(".btn-group");d.mouseenter(function(t){t.stopPropagation()});if(s[0]){if(i=="right"){d.addClass("dropdown-menu-left")}else{d.addClass("dropdown-menu-right")}r=s}if(r.data("bs.popover")){return}a("html").on("click",function(t){if(typeof a(t.target).data("original-title")=="undefined"&&!a(t.target).parents().is(".popover.show")){a("[data-original-title]").popover("hide")}});r.popover({trigger:"manual",html:true,animation:true,content:EW_LOADING_HTML,placement:i,container:"body",fallbackPlacement:"flip"}).on("shown.bs.popover",function(){var t=EW_CSS_FLIP?a(window).width()-(r.offset().left+r.width()):a(window).width()-(r.offset().left+r.width());var e=parseInt(t-60,10)+"px";var i=a(r.data("bs.popover").tip);i.css({"min-width":"350px","max-width":e});i.find(".popover-body").html(a("#ewPreview").html());i.find(".nav-tabs").append(o.find("li:has([data-toggle='tab'])").clone(true));i.find("[data-toggle='tab']").attr("data-target","#"+i.find(".tab-pane").attr("id",ew_Random()).attr("id")).data("$element",r).first().tab("show")}).on("mouseenter",function(){a(this).popover("show");var t=this;a(".popover").on("mouseleave",function(){var e=o.find(".btn-group");if(!e[0])a(t).popover("hide")})}).on("mouseleave",function(){a(this).popover("update");var t=this;setTimeout(function(){var e=o.find(".btn-group");if(!e[0])a(t).popover("hide");if(!a(".popover:hover").length){a(t).popover("hide")}},100)})}function ew_MoveTip(t){$(t).popover("update")}function ew_TabShow(t){var e=jQuery,a=e(t.currentTarget),r=a.data("target"),o=e(r),i=a.data("table"),d="",s;if(!o[0])return;if(a.data("url")){s=o.data(i)||{};s.url=url=a.data("url");start=s.start||1;sort=s.sort;sortOrder=s.sortOrder}else if(a.data("start")){if(a.tooltip)a.tooltip("hide");s=o.data(i);url=s.url;s.start=start=a.data("start")||1;sort=s.sort;sortOrder=s.sortOrder}else if(a.data("sort")){s=o.data(i);url=s.url;start=s.start||1;s.sort=sort=a.data("sort");s.sortOrder=sortOrder=a.data("sortOrder");if(sort!==s.sort||sortOrder!==s.sortOrder){s.start=start=1;s.sortOrder=sortOrder=""}}o.data(i,s).empty().html(EW_LOADING_HTML);if(e.isNumber(start))d+="&start="+start;if(sort){d+="&sort="+encodeURIComponent(sort);if(sortOrder=="ASC"||sortOrder=="DESC")d+="&sortorder="+sortOrder}e.get(url+d,function(t){o.empty().html(t).append(e("div[data-table='"+i+"'][data-url='"+url+"']:first").clone());o.find(".ewPager > div > .btn-group > .btn:not(.disabled), .ewTableHeader > th > div[data-sort]").data({target:r,table:i}).click(ew_TabShow);e(document).trigger("preview",[{$tabpane:o}]);if(a.data("$element"))ew_MoveTip(a.data("$element"))})}function ew_Preview(t,e){var a=e.$tabpane;a.find("table."+EW_TABLE_CLASSNAME).each(ew_SetupTable);ew_InitIcons();a.find("a.ewTooltipLink").each(ew_Tooltip);$(".ewLightbox").each(function(){var t=$(this);t.colorbox($.extend({rel:t.data("rel")},ewLightboxSettings))})}jQuery(document).on("preview",ew_Preview);jQuery(function(t){if(EW_PREVIEW_OVERLAY)t("div.ewPreview").each(function(){t(this).parent().find("[data-action='view'],[data-action='list']").each(ew_Detail)});t(EW_PREVIEW_BUTTON_SELECTOR).click(ew_ShowDetails);t("div.ewPreview [data-toggle='tab']").on("show.bs.tab",ew_TabShow)});